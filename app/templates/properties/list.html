{% extends 'base.html' %}
{% block content %}
<section class="hero">
  <div class="hero-content">
    <h1>Encontrá tu próximo hogar</h1>
    <p>Buscá por título, dirección o descripción.</p>
    <form class="search-bar" method="get" action="{{ url_for('main.index') }}">
      <input type="text" name="q" placeholder="Ej: 3 ambientes en centro" value="{{ q or '' }}">
      <button class="btn btn-primary" type="submit">Buscar</button>
      {% if q %}
        <a class="btn btn-outline" href="{{ url_for('main.index') }}">Limpiar</a>
      {% endif %}
    </form>
    {% if stats %}
    <div class="metrics">
      <div class="metric"><span class="label">Propiedades</span><span class="value">{{ stats.properties }}</span></div>
      <div class="metric"><span class="label">Disponibles</span><span class="value">{{ stats.properties - stats.sold_properties }}</span></div>
      <div class="metric"><span class="label">Vendidas</span><span class="value">{{ stats.sold_properties }}</span></div>
      <div class="metric"><span class="label">Precio prom.</span><span class="value">$ {{ '%.0f' % stats.avg_price }}</span></div>
      <div class="metric"><span class="label">Mín.</span><span class="value">$ {{ '%.0f' % stats.min_price }}</span></div>
      <div class="metric"><span class="label">Máx.</span><span class="value">$ {{ '%.0f' % stats.max_price }}</span></div>
      <div class="metric"><span class="label">Pagos</span><span class="value">{{ stats.paid_count }}</span></div>
      <div class="metric"><span class="label">Ticket prom.</span><span class="value">$ {{ '%.0f' % stats.avg_ticket }}</span></div>
      <div class="metric"><span class="label">Propietarios</span><span class="value">{{ stats.owners_count }}</span></div>
    </div>
    {% endif %}
  </div>
</section>

{% if current_user.is_authenticated %}
  <p><a class="btn btn-accent" href="{{ url_for('propiedades.create') }}">Publicar propiedad</a></p>
{% endif %}

{% if q %}
  <p>Resultados para "<strong>{{ q }}</strong>": <span class="badge">{{ propiedades|length }}</span></p>
{% endif %}

<ul class="property-grid">
  {% for p in properties %}
    <li class="property-card">
      <div class="property-card-body">
        <h3>{{ p.titulo }}</h3>
        <p class="muted">{{ p.direccion }}</p>
        <p class="price">$ {{ '%.2f' % p.price }}</p>
        <a class="btn btn-primary" href="{{ url_for('propiedades.detail', property_id=p.id) }}">Ver detalle</a>
      </div>
    </li>
  {% else %}
    <li>No hay propiedades todavía.</li>
  {% endfor %}
</ul>
{% endblock %}
